# Redirect HTTP to HTTPS
server {
    listen 80;
    server_name chrisshop.com www.chrisshop.com dns.chrisshop.com www.dns.chrisshop.com;

    return 301 https://$host$request_uri;
}

# HTTPS server
server {
    listen 443 ssl;
    server_name chrisshop.com www.chrisshop.com dns.chrisshop.com www.dns.chrisshop.com;

    ssl_certificate /etc/letsencrypt/live/chrisshop.com/fullchain.pem;       # OR dns.chrisshop.com
    ssl_certificate_key /etc/letsencrypt/live/chrisshop.com/privkey.pem;     # Make sure it matches the domain you got SSL for

    # Spring Boot API proxy (restrict IP)
    location /Api {
        proxy_pass http://127.0.0.1:8080;   # Your Spring Boot app
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        allow 58.97.226.174;   # Replace with your trusted IP
        deny all;              # Deny everything else
    }

    # Static content (like index.html) at root
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ =404;
    }
}
